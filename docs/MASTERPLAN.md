# MASTERPLAN - 유자살롱 AI-CMS 프로젝트 (Plan C 중심)

> ⚠️ **ARCHIVED** - 이 문서는 Plan C (Supabase 기반) 설계로, 현재는 사용되지 않습니다.
>
> **현재 플랜: Plan E (Self-Hosted OAuth)**
> - 최신 설계: `docs/PLAN_E_SELF_HOSTED_OAUTH.md`
> - 프로젝트 가이드: `AGENTS.md` (루트)
>
> 이 문서는 히스토리 참고용으로 보존됩니다.

---

## 0) 목적
- Supabase Studio/간단한 관리 화면/CLI에서 글을 관리하고, 정적 사이트로 빠르게 배포한다.
- CLI로 데이터 조회/통계/정리 작업을 쉽게 한다.
- 화면 구성(Astro)은 언제든 교체 가능하도록 한다.

## 1) 확정된 결정사항
- 현재 플랜: Plan C (GitHub Pages 중심)
- 호스팅: GitHub Pages (정적 사이트)
- 자동화: GitHub Actions (빌드/배포)
- DB/Storage: Supabase(Postgres + Storage)
- 프론트: Astro SSG (빌드 시점 데이터 수집)
- 콘텐츠 입력: Supabase Studio + 간단한 관리 화면 + CLI
- CLI 역할: 조회/통계/정리/보조 작업
- 빌드 트리거: 수동 + 일정 주기 보조

## 2) 범위
포함
- 블로그 글/카테고리/태그/요약/대표 이미지
- 정적 빌드 시점 데이터 수집
- 데이터 입력 -> 빌드/배포
- CLI 조회/통계

제외(추후 고려)
- 로그인, 댓글, 실시간 개인화 기능
- 방문자 입력 기반의 실시간 DB 갱신

## 3) 파트별 구현 계획

### Part 0. 정보 구조 설계
목표
- DB 구조와 프론트 데이터 모델을 일치시킨다.

산출물
- 콘텐츠 모델 정의서(필드/타입/필수 여부)
- 카테고리/태그 규칙
- slug 규칙(한글 처리 포함)

완료 조건
- "필드 목록 + 예시 데이터" 문서가 있고, DB/프론트가 동일 구조로 이해됨.

의존성
- 없음

### Part 1. 데이터 인프라 구축 (Supabase)
목표
- DB에서 실제로 CRUD가 되는 상태를 만든다.

산출물
- Supabase 프로젝트 및 테이블
- 샘플 데이터 입력 (Studio 또는 CLI)

완료 조건
- Supabase Studio/CLI에서 글 생성/수정/삭제가 정상 동작.

의존성
- Part 0 완료

### Part 2. 데이터 조회 경로 정리 (읽기 전용)
목표
- Astro 빌드가 사용할 읽기 경로를 확정한다.

산출물
- Supabase REST/SQL 사용 방식 문서
- 필터/정렬/검색 조건 정의
- 캐싱/버전 전략 초안

완료 조건
- "빌드 시점에 필요한 모든 데이터"를 API로 가져올 수 있음.

의존성
- Part 1 완료

### Part 3. Astro SSG 연동
목표
- 빌드 시점에 DB 데이터를 가져와 정적 페이지 생성.

산출물
- 글 목록/상세/카테고리 페이지 구현
- 레이아웃/컴포넌트 분리 구조
- 스타일 토큰/변수 정리

완료 조건
- `npm run build`로 정적 페이지가 생성되고 로컬에서 확인 가능.

의존성
- Part 2 완료

### Part 3.5. 간단한 관리 화면 (Light Admin UI)
목표
- Supabase에 글을 쓰고 수정할 수 있는 최소한의 웹 UI를 제공.

산출물
- `/admin` 페이지 (로그인/작성/수정)
- Supabase Auth + RLS 적용

완료 조건
- 로그인 후 글 작성/수정이 가능하고 데이터가 DB에 저장됨.

의존성
- Part 1 완료

### Part 4. CLI 도구 (조회/통계/보조 발행)
목표
- 터미널에서 데이터 조회/정리 작업이 가능하도록 한다.

산출물
- `scripts/cli/query.js` (조회/통계)
- `scripts/cli/publish.js` (보조 발행)
- 결과 출력 옵션(JSON/CSV)

완료 조건
- CLI로 최소 2~3개의 유의미한 통계가 출력됨.

의존성
- Part 1 완료

### Part 5. GitHub Actions 배포 자동화
목표
- 데이터 변경 후 빌드/배포가 가능하게 한다.

산출물
- Actions 워크플로우
- Secrets 설정 가이드
- 수동/일정 빌드 절차

완료 조건
- 빌드 실행 후 Pages 업데이트가 반영됨.

의존성
- Part 3 완료

### Part 6. 마이그레이션(기존 글)
목표
- 기존 백업 글을 Supabase로 옮긴다.

산출물
- 마이그레이션 스크립트
- 이미지/첨부파일 이관 규칙
- 샘플 10개 이관 결과

완료 조건
- 최소 10개 이상의 기존 글이 새 시스템에서 정상 노출.

의존성
- Part 1 완료

## 4) 추천 작업 순서
- Part 0 -> Part 1 -> Part 2 -> Part 3 -> Part 3.5 -> Part 5 -> Part 4 -> Part 6

이유
- 먼저 "DB"를 안정화하고, 화면과 배포 흐름을 만든 뒤,
  CLI와 마이그레이션은 병렬로 진행하는 편이 안전함.

## 5) 리스크 및 대응
- 실시간 반영 불가: 수동/보조 스케줄로 완화
- API 키 노출 위험: Actions Secrets로만 사용
- 구조 변경 부담: Part 0에서 필드/규칙을 먼저 확정

## 6) Plan C 안내
- Plan A/B는 참고용으로만 유지
- Plan C 제약: 공개 사이트는 DB에 직접 접근하지 않음
- 모든 데이터는 빌드 시점에만 수집

## 7) 참고 문서
- Plan C 설계: `PLAN_C_GITHUB_PAGES.md`
- 간단한 관리 화면: `LIGHT_ADMIN_UI.md`

## 8) 운영 규칙 (문서 갱신 방식)
- 각 Part 완료 시 체크리스트 갱신
- 큰 결정 변경 시 "확정된 결정사항" 섹션 업데이트
- 진행 중인 작업은 파일 맨 아래에 "현재 작업"으로 기록

## 9) 현재 작업 (비워두고 시작)
- 없음
