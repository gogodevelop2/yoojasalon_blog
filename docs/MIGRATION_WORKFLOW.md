# 티스토리 마이그레이션 워크플로우 (Plan C 기준)

## 1) 데이터 구조 확인 요약 (백업 기준)
백업 구조
- 경로: `yoojasalon backup/{id}/{id}-{title}.html`
- 이미지: `yoojasalon backup/{id}/img/*`
- 첨부파일: `yoojasalon backup/{id}/file/*`

HTML에서 추출 가능한 필드
- 제목: `<h2 class="title-article">`
- 카테고리: `<p class="category">`
- 날짜: `<p class="date">` (예: `2009-12-18 11:37:44`)
- 본문: `<div class="contents_style">` 내부 HTML
- 태그: `<div class="tags">` (예: `#태그1 #태그2`)

카테고리 실제 목록(백업 기준)
- 유자살롱 소개 (5)
- 유자노트 (54)
- 보도자료 (61)
- 유자사운드 (35)
- 직딩예술대학 (24)
- 유자살롱 원천기술/두줄기타 (7)
- 유자살롱 원천기술/발로하는작곡 (4)
- 유자살롱 원천기술/ㅇㅈㅇㅇ (4)
- 유자살롱 원천기술/뮤직큐브 (1)
- 유자 X [______] / x 달콤한co-끼리 (5)
- 유자 X [______] / x 집밖에서유유자적 (12)
- 유자 X [______] / x haja (3)
- 유자 X [______] / x ! (2)
- 유자 X [______] (1)
- 모바일 (1)
- "　+ 소개" (11)
- "　+ 지난활동들 / 1기~6기" (총 55)

주의: 티스토리 카테고리 2단계 제한 때문에,
"집밖에서 유유자적"의 3단계 구조가 문자열로 우회 표기되어 있음.

## 2) 카테고리 구조 정리 (정상화 방안)
목표 구조(3단계까지 허용)
- 집밖에서 유유자적
- 집밖에서 유유자적 > 소개
- 집밖에서 유유자적 > 지난활동들 > 1기~6기
- 콜라보 > 유자 X {파트너명}

정상화 규칙(간단 버전)
- `　　　+ 소개` -> `집밖에서 유유자적 > 소개`
- `　　　+ 지난활동들/　　　　　　　1기` -> `집밖에서 유유자적 > 지난활동들 > 1기`
- `유자살롱 원천기술/두줄기타` -> `유자살롱 원천기술 > 두줄기타`
- `유자 X  [______] /　　x 달콤한co-끼리` -> `콜라보 > 유자 X 달콤한co-끼리`
- `유자 X  [______] /　　x 집밖에서유유자적` -> `콜라보 > 유자 X 집밖에서유유자적`
- `유자 X  [______] /　　x haja` -> `콜라보 > 유자 X haja`
- `유자 X  [______] /　　x !` -> `콜라보 > 유자 X !`
- `유자 X  [______]` -> `콜라보 > 유자 X 기타`
- 대괄호/여분 공백은 제거(표기 통일)

## 카테고리 매핑표 (원본 -> 표준)
| 원본(HTML category) | 표준 표기 |
| --- | --- |
| `유자살롱 소개` | `유자살롱 소개` |
| `유자노트` | `유자노트` |
| `보도자료` | `보도자료` |
| `[유자사운드]` | `유자사운드` |
| `[직딩예술대학]` | `직딩예술대학` |
| `유자살롱 원천기술/두줄기타` | `유자살롱 원천기술 > 두줄기타` |
| `유자살롱 원천기술/발로하는작곡` | `유자살롱 원천기술 > 발로하는작곡` |
| `유자살롱 원천기술/ㅇㅈㅇㅇ` | `유자살롱 원천기술 > ㅇㅈㅇㅇ` |
| `유자살롱 원천기술/뮤직큐브` | `유자살롱 원천기술 > 뮤직큐브` |
| `유자 X  [______] /　　x 달콤한co-끼리` | `콜라보 > 유자 X 달콤한co-끼리` |
| `유자 X  [______] /　　x 집밖에서유유자적` | `콜라보 > 유자 X 집밖에서유유자적` |
| `유자 X  [______] /　　x haja` | `콜라보 > 유자 X haja` |
| `유자 X  [______] /　　x !` | `콜라보 > 유자 X !` |
| `유자 X  [______]` | `콜라보 > 유자 X 기타` |
| `모바일` | `모바일` |
| `　　　+ 소개` | `집밖에서 유유자적 > 소개` |
| `　　　+ 지난활동들/　　　　　　　1기` | `집밖에서 유유자적 > 지난활동들 > 1기` |
| `　　　+ 지난활동들/　　　　　　　2기` | `집밖에서 유유자적 > 지난활동들 > 2기` |
| `　　　+ 지난활동들/　　　　　　　3기` | `집밖에서 유유자적 > 지난활동들 > 3기` |
| `　　　+ 지난활동들/　　　　　　　4기` | `집밖에서 유유자적 > 지난활동들 > 4기` |
| `　　　+ 지난활동들/　　　　　　　5기` | `집밖에서 유유자적 > 지난활동들 > 5기` |
| `　　　+ 지난활동들/　　　　　　　6기` | `집밖에서 유유자적 > 지난활동들 > 6기` |

## 3) 권장 데이터 모델(Supabase)
필수 필드
- `title` (문자열)
- `slug` (문자열, URL용)
- `body_md` (Markdown 본문)
- `category_id` (카테고리 참조)
- `tags` (배열)
- `published_at` (날짜/시간)
- `status` (draft/published)
- `legacy_id` (원본 ID, 내부용)
- `legacy_url` (원본 링크, 내부용)

추천 필드
- `summary` (요약)
- `thumbnail` (대표 이미지)
- `attachments` (첨부파일 목록)

카테고리 테이블(별도)
- `name` (카테고리 이름)
- `slug` (URL용, 한글 유지)
- `parent_id` (상위 카테고리)
- `path` (표준 표기, 예: `집밖에서 유유자적 > 지난활동들 > 3기`)

내부용 필드 처리
- `legacy_id`, `legacy_url`은 공개 화면에 노출하지 않음
- 빌드 결과에서 해당 필드를 사용하지 않음

슬러그 규칙
- 공백은 `-`로 치환
- `/`는 `-`로 치환
- 대괄호 및 특수문자(예: `! ? . &`)는 제거
- 중복 발생 시 `-{legacy_id}`를 뒤에 추가

슬러그 예시
- 카테고리: `콜라보 > 유자 X 달콤한co-끼리` -> `콜라보/유자-x-달콤한co-끼리`
- 카테고리: `집밖에서 유유자적 > 지난활동들 > 3기` -> `집밖에서-유유자적/지난활동들/3기`
- 카테고리: `유자살롱 원천기술 > 두줄기타` -> `유자살롱-원천기술/두줄기타`
- 제목: `[두줄기타] 마포는대학 워크숍 리뷰 (091024)` -> `두줄기타-마포는대학-워크숍-리뷰-091024`
- 제목(중복): `작은공연 후기` (legacy_id=152) -> `작은공연-후기-152`

## 4) 마이그레이션 워크플로우
1) 카테고리 정상화 규칙 확정
2) Supabase 테이블 생성(필드 포함)
3) 마이그레이션 스크립트 작성
4) HTML 파싱 -> 필드 매핑
5) 이미지/첨부파일 경로 처리
6) 소량(10개) 테스트 이관
7) 결과 검수 후 전체 이관

Plan C 제약
- 공개 사이트는 DB에 직접 접근하지 않음
- 빌드 시점에만 데이터 수집 후 정적 HTML 생성

## 5) 이미지/첨부파일 처리 옵션
옵션 A: 정적 리포지토리에 복사
- `public/images/posts/{legacy_id}/*`
- `public/files/{legacy_id}/*`
- 장점: GitHub Pages와 잘 맞음

옵션 B: Supabase Storage 사용
- 이미지/파일을 스토리지에 업로드 후 URL 삽입
- 장점: 리포 크기 부담 감소

## 6) 검수 체크리스트
- 제목/날짜/태그가 원본과 일치하는가
- 카테고리 경로가 정상화 규칙을 따르는가
- 본문 이미지가 깨지지 않는가
- 첨부파일 링크가 작동하는가

## 7) 다음 단계 제안
- 카테고리 정상화 규칙을 확정하고 표준 표기(한글/공백/대괄호) 결정
- Supabase 테이블 필드 확정
- 테스트 10개 이관으로 검증

## 8) 마이그레이션 스크립트 설계(초안)
입력
- `yoojasalon backup/{id}/{id}-{title}.html`
- `img/`, `file/` 폴더

처리 순서
1) HTML 파싱
2) 제목/카테고리/날짜/태그/본문 추출
3) 카테고리 정상화 + 슬러그 생성
4) 본문 HTML -> Markdown 변환
5) 이미지/첨부파일 경로 치환
6) Supabase에 업로드 (REST/SQL/SDK)

출력
- Supabase에 새 글 생성
- 로그: 성공/실패 목록

## 9) 테스트 10개 이관 절차
1) 서로 다른 카테고리에서 10개 선택
2) 로컬에서 스크립트 실행
3) Supabase Studio에서 확인
4) 정적 빌드 결과 확인

검수 기준
- 제목/날짜/태그 일치
- 카테고리 경로 정확
- 이미지/첨부파일 깨짐 없음

## 10) 이상 데이터 처리 규칙(초안)
- 태그 없음: 빈 배열로 저장
- 본문이 비어있으면: 요약/제목만 저장하고 상태를 `draft`로 둠
- 첨부파일만 있는 글: 본문에 첨부 링크 유지
